// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  sessions      Session[]
  datasets      Dataset[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Dataset {
  id        String   @id @default(cuid())
  name      String
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  records   ShipmentRecord[]
  
  createdAt DateTime @default(now())
}

model ShipmentRecord {
  id        String   @id @default(cuid())
  datasetId String
  dataset   Dataset  @relation(fields: [datasetId], references: [id], onDelete: Cascade)
  
  // Core fields mapped from CSV
  date              String?   // Storing as string for simplicity, or convert to DateTime
  shipmentId        String?
  product           String?
  quantity          Int?
  pricePerUnit      Float?
  currency          String?
  totalValue        Float?
  port              String?
  countryOfOrigin   String?
  importerName      String?
  exporterName      String?
  hsCode            String?
  
  // Store the full row as JSON to handle extra fields dynamically
  rawData           Json?

  createdAt DateTime @default(now())
}

// NextAuth Models for Authentication
model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?  @db.Text
  access_token       String?  @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
